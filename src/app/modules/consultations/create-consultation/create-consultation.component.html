<div class="consultation-container">
  <div class="consultation-index row align-items-center" *ngIf="step == 1">
    <div class="consultation-index__left col-5">
      <div class="heading-text" i18n>
          Somebody’s taking initiative!
      </div>
      <div class="heading-tips" i18n>
         Discovered a consultation draft? Tell us and we’ll put it up here for citizens to participate.
      </div>

    </div>
    <div class="consultation-index__right offset-3 col-4">
      <div class="form-space">
          <form #consultationForm1="ngForm" (ngSubmit)="stepNext(consultationForm1.valid)" autocomplete="off">
            <div class="input-block">
              <label for="title" i18n>Title of  the Consultation</label>
              <div class="input-block__border">
                  <input type="text" placeholder="Enter Title" name="title" #title="ngModel" id="title" [(ngModel)]="consultationInfo.title" required />
              </div>
              <div *ngIf="title.invalid && (title.touched || consultationForm1.submitted)" class="error-msg" i18n>
                Title is Required
              </div>
              <div class="input-block__tips" i18n>
                  The title has to match the title of the consultation as used by the department
              </div>
            </div>
          <div class="input-block">
              <label for="url" i18n>Paste URL of consultation PDF</label>
              <div class="input-block__border">
                  <input type="text" placeholder="http://" name="url" #url="ngModel" id="url" [(ngModel)]="consultationInfo.url" required
                  pattern="https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]' +
                  '+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9]\.[^\s]{2,}" />
              </div>
              <div *ngIf="url.invalid && (url.touched || consultationForm1.submitted)" class="error-msg" i18n>
                  Url is invalid
              </div>
              <div class="input-block__tips" i18n>
                This is the URL of the PDF or any other document on the department's website
              </div>
          </div>
          <div class="input-block">
              <label for="deadline" i18n>Response submission deadline</label>
              <div class="input-block__border">
                  <input placeholder="dd / mm / yyyy" name="deadline" #deadline="ngModel" id="deadline" [(ngModel)]="consultationInfo.responseDeadline" bsDatepicker [bsConfig]="bsConfig" required />
              </div>
              <div *ngIf="deadline.invalid && (deadline.touched || consultationForm1.submitted)" class="error-msg" i18n>
                  Deadline is Required
              </div>
          </div>
          <div class="input-block">
            <label for="email" i18n>Government Email ID to submit feedback</label>
            <div class="input-block__border">
                <input type="email" placeholder="Enter Email" name="email" #email="ngModel" id="email" [(ngModel)]="consultationInfo.consultationFeedbackEmail" email />
            </div>
            <div *ngIf="email.invalid && (email.touched || consultationForm1.submitted)" class="error-msg">
              <div *ngIf="email.errors.required" i18n>Email is Required</div>
              <div *ngIf="email.errors.email" i18n>Email must be a valid email address</div>
          </div>
          </div>
          <div>
              <button type="submit" class="btn submit-btn d-flex justify-content-between" [ngClass]="{'active-btn' : consultationForm1.valid}">
                <p class="m-0" i18n>NEXT:  DEPARTMENT INFO</p>  
                <span><i class="fa fa-angle-right"></i></span>
              </button>
          </div>
          <div class="query-block">
            <p class="query-heading" i18n>Get Queries?</p>
            <p class="query-content">
              <span i18n>
                If you may need any kind of help with the upload of the consultation, please
              </span> 
              <a href="mailto:info@civis.vote" class="clr-blue" i18n>get in touch</a> 
              <span i18n>with us.</span>
            </p>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="ministry-index row" *ngIf="step == 2">
    <div class="ministry-index__left col-6">
      <div class="heading-text" i18n>
          Which ministry is this consultation by? 
      </div>
      <div class="heading-tips" i18n>
        To publish the consultation, help us with the name of the corresponding department
      </div>
    </div>
    <div class="ministry-index__right offset-2 col-4">
        <form #consultationForm2="ngForm" (ngSubmit)="submit(consultationForm2.valid)" autocomplete="off">
          <div class="input-block">
            <label for="ministry">Ministry</label>
              <div class="location-box__border">
                  <ng-select id="ministry" #ministry="ngModel" name="ministry" [loading]="loadingMinistries"
                  [items]="ministries" bindLabel="name" [virtualScroll]="true" dropdownPosition="bottom" 
                  bindValue="id" [notFoundText]="dropdownText" [clearable]="true" loadingText="Searching..."
                  (search)="onSearch($event)" placeholder="Select" (open)="getMinistriesList()" [(ngModel)]="departmentInfo.ministryId" required> 
                  </ng-select>  
              </div>    
              <div *ngIf="ministry.invalid && (ministry.touched || consultationForm2.submitted)" class="error-msg" i18n>
                Ministry is Required
              </div>
            <div #addMinistryElement>
                <button class="add-ministry-block w-100 d-flex justify-content-between" *ngIf="searchText && showAddMinistryBlock" (click)="openAddMinistryModal($event)">
                    <p class="m-0"><span i18n>Add Ministry</span> {{'"' + searchText + '"'}}</p>
                    <span><i class="fa fa-plus"></i></span>
                  </button>
            </div>
          </div>
          <div>
            <button type="submit" class="btn submit-btn d-flex justify-content-between" [ngClass]="{'active-btn': consultationForm2.valid}">
              <p class="m-0" i18n>SUBMIT CONSULTATION </p>
              <span><i class="fa fa-angle-right"></i></span>
            </button>
          </div>
        </form>
        <div class="back-btn" (click)="step = 1">
          <span><i class="fa fa-angle-left"></i></span> 
          <span i18n>
            BACK TO CONSULTATION INFO
          </span>
        </div>
        <div class="query-block">
            <p class="query-heading" i18n>Get Queries?</p>
            <p class="query-content">
            <span i18n>
              If you need any kind of help with creating a consultation, please 
            </span>
            <a href="mailto:info@civis.vote" class="clr-blue" i18n>get in touch</a>
            <span i18n>
              with us.
            </span>
          </p>
          </div>
    </div>
  </div>

  <div class="consultation-success-index" *ngIf="step === 3">
      <div class="success-message">
        <div class="heading" i18n>
            Hooraah!
        </div>
        <div class="text" i18n>
            Thank you for submitting the consultation.
        </div>
        <div class="text" i18n>
            We’ll notify and post your draft within 24-36 hours    
        </div>
        <div class="link" i18n>
            You’ve been mailed the draft. Preview it here
        </div>
      </div>
      <div class="succes-image">
        <picture>
          <source srcset="assets/images/success.webp" type="image/webp">
          <source srcset="assets/images/success.jpg" type="image/jpeg">
          <img src="assets/images/success.jpg" alt="steps image" />
        </picture>
      </div>
    </div>

<div bsModal #addMinistryModal="bs-modal" class="modal fade ministry-modal" tabindex="-1" (onHidden)="hideAddMinistryModal()"
     [config]="{show: false}"
     role="dialog" aria-labelledby="addMinistryModal">
  <div class="modal-dialog post-create-modal">
    <div class="modal-content">
      <div class="space-around">
          <div class="modal-header">
              <p class="subheader-text">
                  <span i18n>ADD A MINISTRY </span>
                  <br>
                  <span class="light-text">Or, </span>
                  <span class="link-text" (click)="hideAddMinistryModal()" i18n>Select an existing department</span>
              </p>
              <div class="modal-close-btn" (click)="hideAddMinistryModal()"><i class="fa fa-times"></i></div>
            </div>
            <div class="modal-body py-0 mb-4 d-flex">
      
              <div class="form-space">
                  <form #ministryForm="ngForm" (ngSubmit)="addMinistry(ministryForm.valid)" autocomplete="off">
                    <div class="input-block">
                      <label for="name" i18n>Ministry*</label>
                      <div class="input-block__border">
                          <input type="text" placeholder="Ministry Name" name="name" #name="ngModel" id="name" [(ngModel)]="ministryObject.name" required />
                      </div>
                      <div *ngIf="name.invalid && (name.touched || ministryForm.submitted)" class="error-msg" i18n>
                          Ministry Name is Required
                      </div>
                    </div>
                  <div class="input-block">
                      <label for="category" i18n>Category</label>
                        <ng-select id="category" #category="ngModel" name="category" 
                        [items]="categoriesList" bindLabel="name" [virtualScroll]="true" dropdownPosition="bottom" 
                        bindValue="id" [searchable]="false"
                        [(ngModel)]="ministryObject.categoryId" required> 
                        </ng-select> 
                        <div *ngIf="category.invalid && (category.touched || ministryForm.submitted)" class="error-msg" i18n>
                            Category is Required
                        </div>
                  </div>
                  <div class="input-block">
                      <label for="deadline" i18n>Department Logo</label>   
                      <div class="input-block__upload-field">
                        <label class="w-100 m-0">
                          <input type="file" ngFileSelect (uploadOutput)="onUploadOutput($event)" [uploadInput]="uploadInput" hidden required /> 
                          <span><i class="fa fa-cloud-upload"></i></span>
                          {{ ministryObject?.logoFile?.filename ? ministryObject.logoFile.filename :  'Select File'  }}
                        </label>
                    </div>     
                  </div>
                  <div class="input-block">
                    <label for="level">Level*</label>
                      <ng-select id="level" #level="ngModel" name="level"  
                      [items]="levels" bindLabel="name" [virtualScroll]="true" dropdownPosition="bottom" 
                      bindValue="name" [searchable]="false"
                      [(ngModel)]="ministryObject.level" required> 
                      </ng-select>  
                      <div *ngIf="level.invalid && (level.touched || ministryForm.submitted)" class="error-msg" i18n>
                          Level is Required
                      </div>
                </div>
                  <div class="input-block">
                      <label for="category" i18n>Primary email address of the ministry POC</label>
                      <div class="input-block__border">
                          <input type="text" placeholder="Enter email" name="primaryEmail" #primaryEmail="ngModel" id="primary_email" [(ngModel)]="ministryObject.pocEmailPrimary" required email/>
                      </div>
                      <div *ngIf="primaryEmail.invalid && (primaryEmail.touched || ministryForm.submitted)" class="error-msg">
                          <div *ngIf="primaryEmail.errors.required" i18n>Primary Email is Required</div>
                          <div *ngIf="primaryEmail.errors.email" i18n>Primary Email must be a valid email address</div>
                      </div>
                      <div class="input-block__tips" i18n>
                        This is the point-of-contact or person who will be sent the responses
                    </div>
                  </div>
                  <div class="input-block">
                      <label for="category" i18n>Secondary email address of the ministry POC</label>
                      <div class="input-block__border">
                          <input type="text" placeholder="Enter email" name="secondaryEmail" #secondaryEmail="ngModel" id="secondary_email" [(ngModel)]="ministryObject.pocEmailSecondary" />
                      </div>
                  </div>
                  <div>
                    <button type="submit" class="btn submit-btn d-flex justify-content-between">
                      <p class="m-0" i18n>Add Ministry</p>
                      <span><i class="fa fa-angle-right"></i></span>
                    </button>
                  </div>
                </form>
              </div>
            </div>
      </div>
    </div>
  </div>
</div>
</div>
<app-footer></app-footer>