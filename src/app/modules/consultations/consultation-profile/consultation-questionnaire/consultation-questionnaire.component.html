<div class="paper-effect  mt-4 m-0-sm" #questionnaireContainer>
  <p class="satisfactory-heading">
    <p class="satisfactory-heading">
      {{'How satisfied are you with this Consultation' | translate}}
    </p>
    <p class="satisfactory-tip">
      {{'Choose an option to submit your feedback' | translate}}
    </p>
    <div class="options-block">
      <button 
        class="grey-bg"
        [ngClass]="{'active': (responseFeedback === 'dissatisfied')}"
        (click)="setSatisfactoryRating('dissatisfied')">
        <span>
          <img src="assets/images/dissatisfied.svg" />
          Dissatisfied
        </span>
      </button>
      <button 
        class="grey-bg"
        [ngClass]="{'active': (responseFeedback === 'somewhat_dissatisfied')}"
        (click)="setSatisfactoryRating('somewhat_dissatisfied')">
        <span>
          <img src="assets/images/somewhat_dissatisfied.svg" />
          Somewhat Dissatisfied
        </span>
      </button>
      <button 
        class="grey-bg"
        [ngClass]="{'active': (responseFeedback === 'somewhat_satisfied')}"
        (click)="setSatisfactoryRating('somewhat_satisfied')">
        <span>
          <img src="assets/images/somewhat_satisfied.svg" />
          Somewhat Satisfied
        </span>
      </button>
      <button 
        class="grey-bg"
        [ngClass]="{'active': (responseFeedback === 'satisfied')}"
        (click)="setSatisfactoryRating('satisfied')">
        <span>
          <img src="assets/images/satisfied.svg" />
          Satisfied
        </span>
      </button>
    </div>
    <p class="error-msg" *ngIf="showError && !responseFeedback">Please select a Satisfaction Rating to submit the response</p>
    <div class="hr-line"></div>
    <div class="question-box">
      <form [formGroup]="questionnaireForm">
        <div class="questions-container">
          <div class="question-index" *ngFor="let question of profileData?.questions; let i = index">
              <div class="question">
                <p class="question-text">
                  <span class="question-text__number">{{i+1}}.</span>
                  {{question.questionText}} 
                  <span *ngIf="!question.isOptional" class="required-text pl-1"> *</span>
                </p>
                <div class="answer" *ngIf="question.questionType === 'multiple_choice'">
                  <div class="option-box" *ngFor="let subQuestion of question.subQuestions">
                    <label>
                      <input type="radio" class="cm-radio" (input)="onAnswerChange(question,subQuestion)" [formControlName]="question.id" [value]="subQuestion.id">
                      <span>{{subQuestion.questionText}}</span>
                    </label>
                  </div>
                  <div *ngIf="showError && questionnaireForm.controls[question.id].errors" class="error-msg text-left">This is a mandatory question and your response is required</div>
                </div>
                <div class="answer" *ngIf="question.questionType === 'dropdown'">
                    <ng-select 
                    [items]="question.subQuestions" bindLabel="questionText" [virtualScroll]="true" dropdownPosition="bottom" 
                    bindValue="id"  [clearable]="false" loadingText="Searching..." [searchable]="false" (change)="onAnswerChange(question, $event)"
                    placeholder="Select an option" [formControlName]="question.id"> 
                    </ng-select>
                    <div *ngIf="showError && questionnaireForm.controls[question.id].errors" class="error-msg text-left">This is a mandatory question and your response is required</div>  
                </div>
                <div class="answer" [formGroupName]="question.id" *ngIf="question.questionType === 'checkbox'">
                  <label class="answer__tips">Choose as many as you like</label>
                  <div class="option-box" *ngFor="let subQuestion of question.subQuestions">
                    <label>
                      <input type="checkbox" class="cm-radio" (input)="onAnswerChange(question,subQuestion, $event.target.checked)" [formControlName]="subQuestion.id" (click)="toggleCheckbox(question.id, subQuestion.id)">
                      <span>{{subQuestion.questionText}}</span>
                    </label>
                  </div>
                  <div *ngIf="showError && questionnaireForm.controls[question.id].errors" class="error-msg text-left">This is a mandatory question and your response is required</div>
                </div>
                <div class="answer" [id]="'text-area-' + question.id" *ngIf="question.questionType === 'long_text'">
                  <div class="text-area">
                    <textarea (input)="longTextAnswer = $event.target.value" placeholder="Type your answer here" [formControlName]="question.id"></textarea>
                  </div>
                  <div *ngIf="showError && questionnaireForm.controls[question.id].errors" class="error-msg text-left">This is a mandatory question and your response is required</div> 
                </div>
                <div class="input-box" *ngIf="question.is_other">
                  <div class="input-box__border">
                    <input placeholder="Type answer here" type="text"
                    [formControlName]="question.other_answer" />
                  </div>
                </div>
                <div *ngIf="showError && questionnaireForm.controls[question.other_answer]?.errors && question.is_other" class="error-msg text-left ml-3">This is a mandatory question and your response is required</div> 
              </div>
            </div>
          </div>
          <div class="checkbox-area" *ngIf="longTextAnswer !== templateText">
            <div class="input-checbox" >
              <input class="cm-checkbox mr-2" type="checkbox" [(ngModel)]="responseVisibility" [ngModelOptions]="{standalone: true}"/> 
              <label class="m-0">{{'Make my response public' | translate}}</label>
              <span class="link">{{'What does this mean?' | translate}}</span>
            </div>
          </div>
          <div class="py-3">
            <button  class="btn-submit active" (click)='submitAnswer()' [tooltip]="showError ? 'Please fill all the answers to submit response.' : ''" data-event="purchase">
              <p class="m-0">
                SUBMIT RESPONSE
              </p>
              <span class="ml-2"><i class="fa fa-angle-right"></i></span>
            </button>
          </div>
      </form>
    </div>
  </div>
  <app-confirm-email-modal *ngIf="showConfirmEmailModal" (close)="showConfirmEmailModal = false">
  </app-confirm-email-modal>