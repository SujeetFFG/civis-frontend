<section class="read-response-container">
  <div class="paper-effect">
    <p class="heading">
      {{'Summary' | translate}}
      <span>{{profileData?.readingTime ? '(' + profileData?.readingTime + ' min)' : '' }}</span>
    </p>
    <app-page-content-renderer [page]="profileData?.page"></app-page-content-renderer>
  </div>

  <div class="response-index mt-4" ngResizable [rzHandles]="'s'" *ngIf="showCreateResponse()" #responseIndex>
    <div class="response-index__nav">
      <div class="w-50">
        <div class="heading">{{'Your response' | translate}}</div>
      </div>
      <div class="w-50 row no-gutters justify-content-end align-items-center" *ngIf="profileData?.reviewType !== 'policy'">
        <div (click)="scrollToResponses()" class="link mr-3">{{'or, select a public response' | translate}}</div>
        <div class="info-mark"><i class="fa fa-question-circle"></i></div>
      </div>
    </div>
    <div class="response-index__content" id="editor-container">
      <ckeditor
      [(ngModel)]="responseText"
      [config]="ckeConfig"
      (change)="enableSubmitResponse($event)"
      (blur)="autoSave(responseText)"
      debounce="0">
      </ckeditor>
      <!-- <textarea class="text-space" placeholder="Type your response here..." [(ngModel)]="responseText" (blur)="autoSave(responseText)" (ngModelChange)="enableSubmitResponse($event)"></textarea> -->
    </div>
    <div class="response-index__footer" *ngIf="profileData?.reviewType !== 'policy'">
      <div class="checkbox-area" *ngIf="showPublicResponseOption">
        <div class="input-checbox" >
          <input class="cm-checkbox mr-2" type="checkbox" [(ngModel)]="responseVisibility"/> 
          <label class="m-0">{{'Make my response public ' | translate}}</label>
          <span class="link">{{'What does this mean?' | translate}}</span>
        </div>
        <p class="auto-save-text" *ngIf="showAutoSaved">{{'Draft autosaved' | translate}}</p>
      </div>
      <div class="draggable-area">
        <span class="drag-bars"></span>
        <span class="drag-bars"></span>
      </div>
    </div>
  </div>
  
  <ng-container *ngIf="profileData?.reviewType !== 'policy'">
    <div class="paper-effect mt-4 m-0-sm " *ngIf="responseList?.length"  #responsesListContainer>
      <div class="d-flex justify-content-between">
        <p class="text-16 m-0 bold-text">{{'Public responses' | translate}}</p>
        <p 
          class="what-resp-text" 
          tooltip="If you feel passionately about this Consultation, you can make your response public, 
          for others to use as a template. Your first name is shared with the Government if you make your response public.
          If you’re not sure what to write, you can choose other people’s responses to send as your own." 
          placement="left"
          container="body"
          >
          {{'What are public responses?' | translate}}
        </p>
      </div>
      <ng-container *ngFor="let response of responseList">
        <div class="response-container" [id]="response?.node?.id">
          <div class="d-inline-flex align-items-center">
            <img 
            class="avatar avatar--42 pointer"
            appDefaultImage
            [type]="'user'"
            [src]="response?.node?.user?.profilePicture?.url"
            (click)="openUserProfile(response?.node?.user)" />
            <p class="regular-text bold-text m-0 ml-2">{{response?.node.user.firstName}}</p>
          </div>
          <p class="text-16" [innerHTML]="response.node.responseText"></p>
          <div class="vote-section" *ngIf="currentUser">
            <div class="vote-count">
              <div [ngClass]="response?.node.votedAs?.voteDirection === 'up'  ? 'active' : ''">
                  <span (click)="vote('up', response?.node)"
                    tooltip="{{'Upvote'}}"
                  [ngClass]="response?.node.votedAs?.voteDirection === 'up' ? 'active__btn' : ''"><i class="fa fa-thumbs-up"></i></span>
                  <span>{{response.node?.upVoteCount ? response.node?.upVoteCount : '' }}</span>
              </div>
              <div [ngClass]="response?.node.votedAs?.voteDirection === 'down'  ? 'active' : ''">
                  <span (click)="vote('down', response?.node)" 
                  tooltip="{{'Downvote'}}"
                  class="ml-4" [ngClass]="response?.node.votedAs?.voteDirection === 'down' ? 'active__btn' : ''"><i class="fa fa-thumbs-down"></i></span>
                  <span>{{ response.node?.downVoteCount ? response.node?.downVoteCount : ''}}</span>
              </div>
              <div class="share-block">
                  <div class="share-block__position">
                    <div #shareBlockElement *ngIf="showShareBlock" class="share-pop-up">
                        <share-button 
                        [button]="'facebook'"
                        [url]="getSharingUrl(response?.node?.id)"
                        [autoSetMeta]="false"
                        (closed)="showShareOptions = false"
                        ></share-button>
                        <a  class="tweet-block"
                        [href]="getTwitterUrl(currentUrl, response?.node?.id)"
                        target="_blank">
                          <span>
                              <i class="fa fa-twitter"></i>
                          </span>
                        </a>
                        <share-button 
                        [button]="'whatsapp'"
                        [url]="getSharingUrl(response?.node?.id)"
                        [autoSetMeta]="false"
                        (closed)="showShareOptions = false"
                        ></share-button>
                    </div>
                  </div>
                  <span #shareButtonElement (click)="showShareBlock = !showShareBlock"
                  class="ml-4 mr-2 fs-20 pointer" tooltip="{{'Share'}}"><i class="fa fa-share"></i></span>
                  <span>{{response.node?.templatesCount ? response.node?.templatesCount : '' }}</span>
              </div>
            </div>
            <div>
              <button class="app-btn response-btn" (click)="useThisResponse(response?.node)" >{{'Use this response' | translate}}</button>
            </div>
          </div>
        </div>
      </ng-container>
    </div>   
  </ng-container>   
</section>
<div *ngIf="selectedUser && showLeaderProfileModal">
  <app-user-profile-modal (close)="closeModal($event)" [userId]="selectedUser"></app-user-profile-modal>
</div>

<!-- rating-model -->
<div class="feedback-index">
    <div bsModal #feedbackModal="bs-modal" class="modal fade" tabindex="-1" [ngClass]="step == 2 ? 'align-center' : ''"
      [config]="{show: false, backdrop: 'static', ignoreBackdropClick: true, keyboard: false}" role="dialog"
      aria-labelledby="feedbackModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <p class="heading" *ngIf="!responseSubmitted">{{'How satisfied are you with this draft?' | translate}}</p>
            <p class="heading" *ngIf="responseSubmitted">{{'Here’re the overall satisfation levels for this draft from people' | translate}}</p>
          </div>
          <div class="modal-body">
            <label class="radio-block">
              <div class="radio-btn">
                <div class="radio-text" [class.active-text]="responseSubmitted && responseFeedback === 'dissatisfied'">{{'Dissatisfied' | translate}}</div>
                <div class="mx-2 count-text" *ngIf="responseFeedback && responseSubmitted">{{satisfactionRatingDistribution?.dissatisfied ?
                  satisfactionRatingDistribution?.dissatisfied : 0}}</div>
                <div *ngIf="responseFeedback" class="progress-color" [class.active-progress]="responseSubmitted && responseFeedback === 'dissatisfied'"
                  [ngStyle]="{'width': satisfactionRatingDistribution?.dissatisfied ? getPercentageValue(satisfactionRatingDistribution, 'dissatisfied') + '%' : '0%' }"></div>
              </div>
              <div class="input-space">
                <input type="radio" class="cm-radio ml-3" name="feedback" value="dissatisfied" [(ngModel)]="responseFeedback"
                  (ngModelChange)="choose($event)" [disabled]="(responseSubmitted && responseFeedback && responseFeedback !== 'dissatisfied')">
              </div>
            </label>
            <label class="radio-block">
              <div class="radio-btn">
                <div class="radio-text" [class.active-text]="responseSubmitted && responseFeedback === 'somewhat_dissatisfied'">{{'Somewhat Dissatisfied' | translate}}</div>
                <div class="mx-2 count-text" *ngIf="responseFeedback && responseSubmitted">{{satisfactionRatingDistribution?.somewhat_dissatisfied
                  ? satisfactionRatingDistribution?.somewhat_dissatisfied : 0}}</div>
                <div *ngIf="responseFeedback" class="progress-color" [class.active-progress]="responseSubmitted && responseFeedback === 'somewhat_dissatisfied'"
                  [ngStyle]="{'width': satisfactionRatingDistribution?.somewhat_dissatisfied ? getPercentageValue(satisfactionRatingDistribution, 'somewhat_dissatisfied') + '%' : '0%' }"></div>
              </div>
              <div class="input-space">
                <input type="radio" class="cm-radio ml-3" name="feedback" value="somewhat_dissatisfied" [(ngModel)]="responseFeedback"
                  (ngModelChange)="choose($event)" [disabled]="(responseSubmitted && responseFeedback && responseFeedback !== 'somewhat_dissatisfied')">
              </div>
            </label>
            <label class="radio-block">
              <div class="radio-btn">
                <div class="radio-text" [class.active-text]="responseSubmitted && responseFeedback === 'somewhat_satisfied'">{{'Somewhat Satisfied' | translate}}</div>
                <div class="mx-2 count-text" *ngIf="responseFeedback && responseSubmitted">{{satisfactionRatingDistribution?.somewhat_satisfied
                  ? satisfactionRatingDistribution?.somewhat_satisfied : 0}}</div>
                <div *ngIf="responseFeedback" class="progress-color" [class.active-progress]="responseSubmitted && responseFeedback === 'somewhat_satisfied'"
                  [ngStyle]="{'width': satisfactionRatingDistribution?.somewhat_satisfied ? getPercentageValue(satisfactionRatingDistribution, 'somewhat_satisfied') + '%' : '0%' }"></div>
              </div>
              <div class="input-space">
                <input type="radio" class="cm-radio ml-3" name="feedback" value="somewhat_satisfied" [(ngModel)]="responseFeedback"
                  (ngModelChange)="choose($event)" [disabled]="(responseSubmitted && responseFeedback && responseFeedback !== 'somewhat_satisfied')">
              </div>
            </label>
            <label class="radio-block">
              <div class="radio-btn">
                <div class="radio-text" [class.active-text]="responseSubmitted && responseFeedback === 'satisfied'">{{'Satisfied' | translate}}</div>
                <div class="mx-2 count-text" *ngIf="responseFeedback && responseSubmitted">{{satisfactionRatingDistribution?.satisfied ?
                  satisfactionRatingDistribution?.satisfied : 0}}</div>
                <div *ngIf="responseFeedback" class="progress-color" [class.active-progress]="responseSubmitted && responseFeedback === 'satisfied'"
                  [ngStyle]="{'width': satisfactionRatingDistribution?.satisfied ? getPercentageValue(satisfactionRatingDistribution, 'satisfied') + '%' : '0%' }"></div>
              </div>
              <div class="input-space">
                <input type="radio" class="cm-radio ml-3" name="feedback" value="satisfied" [(ngModel)]="responseFeedback"
                  (ngModelChange)="choose($event)" [disabled]="(responseSubmitted && responseFeedback && responseFeedback !== 'satisfied')">
              </div>
            </label>
            <div class="footer-space" [ngClass]="responseSubmitted ? 'justify-content-between' : 'justify-content-end'">
              <div class="footer-space__left" *ngIf="responseSubmitted">
                <div class="points-text">{{'You get ' + earnedPoints + ' points for submitting this!'}}</div>
                <div class="link">{{'View Leaderboard' | translate}}</div>
              </div>
              <div class="footer-space__right">
                <button  class="app-btn secondary mt-xs" *ngIf="responseSubmitted" (click)="closeFeedbackModal()">
                  <p class="m-0">
                    <span class="submit-logo">
                      <picture class="citizen-logo">
                        <source srcset="assets/images/Vector.webp" type="image/webp">
                        <source srcset="assets/images/Vector.jpg" type="image/jpeg">
                        <img src="assets/images/Vector.jpg" />
                      </picture>
                    </span>
                    {{'Ok Great' | translate}}
                  </p>
                  <i class="fa fa-angle-right"></i>
                </button>
                <span class="mr-2" *ngIf="responseSubmitLoading">
                    <img src="assets/images/loading.svg">
                </span>
                <button class="app-btn secondary" *ngIf="!responseSubmitted" (click)="createResponse()">
                  <p class="m-0">
                    <span class="submit-logo">
                      <picture class="citizen-logo">
                        <source srcset="assets/images/Vector.webp" type="image/webp">
                        <source srcset="assets/images/Vector.jpg" type="image/jpeg">
                        <img src="assets/images/Vector.jpg" />
                      </picture>
                    </span>
                    {{'Select and submit' | translate}}
                  </p>
                  <i class="fa fa-angle-right"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>