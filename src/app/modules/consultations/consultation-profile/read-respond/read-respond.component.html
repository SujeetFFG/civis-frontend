<section class="read-response-container">
  <div class="paper-effect">
    <p class="heading">
      {{'Summary' | translate}}
      <span>{{profileData?.readingTime ? '(' + profileData?.readingTime + ' min)' : '' }}</span>
    </p>
    <div *ngIf="profileData?.page || profileData?.summaryHindi">
      <app-page-content-renderer [page]="useSummaryHindi ? profileData?.summaryHindi : profileData?.page">
      </app-page-content-renderer>
    </div>
  </div>

<section #questionnaireContainer>
  <div class="paper-effect  mt-4 m-0-sm" *ngIf="showCreateResponse() && questionnaireExist()">
    <p class="satisfactory-heading">
      {{'How satisfied are you with this Consultation' | translate}}
    </p>
    <p class="satisfactory-tip">
      {{'Choose an option to submit your feedback' | translate}}
    </p>
    <div class="options-block">
      <button 
        class="dis-satisfied-bg"
        [ngClass]="{'active': (showQuestions && responseFeedback === 'dissatisfied'), 'grey-bg': showQuestions}"
        (click)="setSatisfactoryRating('dissatisfied') ; onChange()">
        <span>
          <img src="assets/images/dissatisfied.svg" />
          Dissatisfied
        </span>
      </button>
      <button 
        class="dis-satisfied-bg"
        [ngClass]="{'active': (showQuestions && responseFeedback === 'somewhat_dissatisfied'), 'grey-bg': showQuestions}"
        (click)="setSatisfactoryRating('somewhat_dissatisfied') ; onChange()">
        <span>
          <img src="assets/images/somewhat_dissatisfied.svg" />
          Somewhat Dissatisfied
        </span>
      </button>
      <button 
        class="satisfied-bg"
        [ngClass]="{'active': (showQuestions && responseFeedback === 'somewhat_satisfied'), 'grey-bg': showQuestions}"
        (click)="setSatisfactoryRating('somewhat_satisfied') ; onChange()">
        <span>
          <img src="assets/images/somewhat_satisfied.svg" />
          Somewhat Satisfied
        </span>
      </button>
      <button 
        class="satisfied-bg"
        [ngClass]="{'active': (showQuestions && responseFeedback === 'satisfied'), 'grey-bg': showQuestions}"
        (click)="setSatisfactoryRating('satisfied') ; onChange()">
        <span>
          <img src="assets/images/satisfied.svg" />
          Satisfied
        </span>
      </button>
    </div>
    <p class="error-msg" *ngIf="showError && !responseFeedback">Please select a Satisfaction Rating to submit the response</p>
    <div class="hr-line"></div>
    <div class="question-box">
      <form [formGroup]="questionnaireForm">
        <div class="questions-container">
          <div class="question-index" *ngFor="let question of profileData?.questions; let i = index">
              <div class="question">
                <p class="question-text">
                  <span class="question-text__number">{{i+1}}.</span>
                  {{question.questionText}} 
                  <span *ngIf="!question.isOptional" class="required-text pl-1"> *</span>
                </p>
                <div class="answer" *ngIf="question.questionType === 'multiple_choice'">
                  <div class="option-box" *ngFor="let subQuestion of question.subQuestions">
                    <label>
                      <input type="radio" class="cm-radio" (input)="onChange(); onAnswerChange(question,subQuestion)" [formControlName]="question.id" [value]="subQuestion.id">
                      <span>{{subQuestion.questionText}}</span>
                    </label>
                  </div>
                  <div *ngIf="showError && questionnaireForm.controls[question.id].errors" class="error-msg text-left">This is a mandatory question and your response is required</div>
                </div>
                <div class="answer" *ngIf="question.questionType === 'dropdown'">
                    <ng-select 
                    [items]="question.subQuestions" bindLabel="questionText" [virtualScroll]="true" dropdownPosition="bottom" 
                    bindValue="id"  [clearable]="false" loadingText="Searching..." [searchable]="false" (change)="onChange();onAnswerChange(question, $event)"
                    placeholder="Select an option" [formControlName]="question.id"> 
                    </ng-select>
                    <div *ngIf="showError && questionnaireForm.controls[question.id].errors" class="error-msg text-left">This is a mandatory question and your response is required</div>  
                </div>
                <div class="answer" [formGroupName]="question.id" *ngIf="question.questionType === 'checkbox'">
                  <label class="answer__tips">Choose as many as you like</label>
                  <div class="option-box" *ngFor="let subQuestion of question.subQuestions">
                    <label>
                      <input type="checkbox" class="cm-radio" (input)="onChange(); onAnswerChange(question,subQuestion, $event.target.checked)" [formControlName]="subQuestion.id" (click)="toggle(question.id, subQuestion.id)">
                      <span>{{subQuestion.questionText}}</span>
                    </label>
                  </div>
                  <div *ngIf="showError && questionnaireForm.controls[question.id].errors" class="error-msg text-left">This is a mandatory question and your response is required</div>
                </div>
                <div class="answer" [id]="'text-area-' + question.id" *ngIf="question.questionType === 'long_text'">
                  <div class="text-area">
                    <textarea (input)="responseText = $event.target.value; onChange()" placeholder="Type your answer here" [formControlName]="question.id"></textarea>
                  </div>
                  <div *ngIf="showError && questionnaireForm.controls[question.id].errors" class="error-msg text-left">This is a mandatory question and your response is required</div> 
                </div>
                <div class="input-box" *ngIf="question.is_other">
                  <div class="input-box__border">
                    <input placeholder="Type answer here" type="text"
                    [formControlName]="question.other_answer" />
                  </div>
                </div>
                <div *ngIf="showError && questionnaireForm.controls[question.other_answer]?.errors && question.is_other" class="error-msg text-left ml-3">This is a mandatory question and your response is required</div> 
              </div>
            </div>
          </div>
          <div class="checkbox-area" *ngIf="responseText !== templateText">
            <div class="input-checbox" >
              <input class="cm-checkbox mr-2" type="checkbox" [(ngModel)]="responseVisibility" [ngModelOptions]="{standalone: true}"/> 
              <label class="m-0">{{'Make my response public' | translate}}</label>
              <span class="link">{{'What does this mean?' | translate}}</span>
            </div>
          </div>
          <div class="py-3">
            <button  class="btn-submit active" (click)='submitAnswer()' [tooltip]="showError ? 'Please fill all the answers to submit response.' : ''" data-event="purchase">
              <p class="m-0">
                SUBMIT RESPONSE
              </p>
              <span class="ml-2"><i class="fa fa-angle-right"></i></span>
            </button>
          </div>
      </form>
    </div>
  </div>
</section>

  <div class="response-index mt-4" ngResizable [rzHandles]="'s'" *ngIf="showCreateResponse() && !questionnaireExist()"
    #responseIndex>
    <div class="response-index__nav">
      <div class="w-50">
        <div class="heading">{{'Your response' | translate}}</div>
      </div>
      <div class="w-50 row no-gutters justify-content-end align-items-center"
        *ngIf="profileData?.reviewType !== 'policy'">
        <div (click)="scrollToResponses()" class="link mr-3">{{'or, select a public response' | translate}}</div>
        <div class="info-mark"><i class="fa fa-question-circle"></i></div>
      </div>
    </div>
    <div class="response-index__content" id="editor-container">
      <ckeditor
      *ngIf="enableCkEditor"
      [(ngModel)]="responseText"
      [config]="ckeConfig"
      (change)="enableSubmitResponse($event)"
      (blur)="autoSave(responseText)"
      debounce="0">
      </ckeditor>
      <!-- <textarea class="text-space" placeholder="Type your response here..." [(ngModel)]="responseText" (blur)="autoSave(responseText)" (ngModelChange)="enableSubmitResponse($event)"></textarea> -->
    </div>
    <div class="response-index__footer" *ngIf="profileData?.reviewType !== 'policy'">
      <div class="checkbox-area" *ngIf="showPublicResponseOption">
        <div class="input-checbox">
          <input class="cm-checkbox mr-2" type="checkbox" [(ngModel)]="responseVisibility" />
          <label class="m-0">{{'Make my response public' | translate}}</label>
          <span class="link">{{'What does this mean?' | translate}}</span>
        </div>
        <div class="d-flex">
          <p class="auto-save-text mr-2" *ngIf="showAutoSaved">{{'Draft autosaved' | translate}}</p>
          <p class="auto-save-text pointer" (click)="autoSave(responseText)">{{'Save as Draft' | translate}}</p>
        </div>
      </div>
      <div class="draggable-area">
        <span class="drag-bars"></span>
        <span class="drag-bars"></span>
      </div>
    </div>
  </div>
  
  <div *ngIf="profileData?.reviewType !== 'policy'">
    <div class="paper-effect mt-4 m-0-sm " *ngIf="responseList?.length"  #responsesListContainer>
      <div *ngIf="satisfactionRatingDistribution">
        <p class="text-16 m-0 bold-text">{{'Consultation satisfication' | translate}}</p>
        <div class="d-flex mt-3 mb-3">
            <div class="satisfication-response">
                <img src="assets/images/dissatisfied.svg" />
                <p class="text-16 m-0 bold-text pl-2">{{satisfactionRatingDistribution?.dissatisfied ? satisfactionRatingDistribution?.dissatisfied : '0'}}</p>
            </div>
            <div class="satisfication-response">
                <img src="assets/images/somewhat_dissatisfied.svg" />
                <p class="text-16 m-0 bold-text pl-2">{{satisfactionRatingDistribution?.somewhat_dissatisfied ? satisfactionRatingDistribution?.somewhat_dissatisfied : '0'}}</p>
            </div>
            <div class="satisfication-response">
                <img src="assets/images/somewhat_satisfied.svg" />
                <p class="text-16 m-0 bold-text pl-2">{{satisfactionRatingDistribution?.somewhat_satisfied ? satisfactionRatingDistribution?.somewhat_satisfied : '0'}}</p>
            </div>
            <div class="satisfication-response">
                <img src="assets/images/satisfied.svg" />
                <p class="text-16 m-0 bold-text pl-2">{{satisfactionRatingDistribution?.satisfied ? satisfactionRatingDistribution?.satisfied : '0'}}</p>
            </div>
        </div>

      </div>
      <div class="d-flex justify-content-between">
        <p class="text-16 m-0 bold-text">{{'Public responses' | translate}}</p>
        <p class="what-resp-text" tooltip="If you feel passionately about this Consultation, you can make your response public, 
          for others to use as a template. Your first name is shared with the Government if you make your response public.
          If you’re not sure what to write, you can choose other people’s responses to send as your own."
          placement="left" container="body">
          {{'What are public responses?' | translate}}
        </p>
      </div>
      <ng-container *ngFor="let response of responseList">
        <div class="response-container pb-0" [id]="response?.node?.id">
          <div class="d-inline-flex align-items-center">
            <img class="avatar avatar--42 pointer" appDefaultImage [type]="'user'"
              [src]="response?.node?.user?.profilePicture?.url" (click)="openUserProfile(response?.node?.user)" />
            <div>
              <p class="regular-text bold-text m-0 ml-2">{{response?.node?.user?.firstName}}</p>
              <p class="email-text m-0 ml-2">{{response?.node?.user?.email}}</p>
            </div>
          </div>     
          <p class="text-16" *ngIf="!response?.node?.answers" [innerHTML]="response.node?.responseText"></p>
          <div *ngIf="responseQuestions && response?.node?.answers">
            <app-response-answers [showOnlyLongTextAnswer]="true" [questions]="responseQuestions" [answers]="response?.node?.answers"></app-response-answers>
          </div>
          <div class="vote-section" *ngIf="currentUser">
            <div class="vote-count">
              <div class="vote-item"  
              (click)="vote('up', response?.node)" 
              tooltip="{{'Upvote'}}" 
              [ngClass]="response?.node?.votedAs?.voteDirection === 'up'  ? 'vote-item-active' : ''">
                <span><i class="fa fa-thumbs-up"></i></span>
                <span>
                  {{response.node?.upVoteCount ? response.node?.upVoteCount : '' }}
                </span>
              </div>
              <div class="vote-item" 
              (click)="vote('down', response?.node)" 
              tooltip="{{'Downvote'}}"
              [ngClass]="response?.node?.votedAs?.voteDirection === 'down'  ? 'vote-item-active' : ''">
                <span><i class="fa fa-thumbs-down"></i></span>
                <span>
                  {{ response.node?.downVoteCount ? response.node?.downVoteCount : ''}}
                </span>
              </div>
              <div data-event="click-share-response" class="share-block"  (click)="toggleShareBlock(response?.node?.id); shareBtnClicked = true">
                  <div class="share-block__position">
                    <div #shareBlockElement *ngIf="showShareBlock && (responseId && responseId === response?.node?.id)" class="share-pop-up">
                        <a  class="share-btn"
                        [href]="getFbUrl(currentUrl)"
                        target="_blank">
                          <span>
                              <i class="fa fa-facebook"></i>
                          </span>
                        </a>
                        <a  class="share-btn"
                        [href]="getTwitterUrl(currentUrl, response?.node?.id)"
                        target="_blank">
                          <span>
                              <i class="fa fa-twitter"></i>
                          </span>
                        </a>
                        <a  class="share-btn"
                        [href]="getWhatsappUrl(currentUrl)"
                        target="_blank">
                          <span>
                              <i class="fa fa-whatsapp"></i>
                          </span>
                        </a>
                        <a  class="share-btn"
                        [href]="getLinkedinUrl(currentUrl)"
                        target="_blank">
                          <span>
                              <i class="fa fa-linkedin"></i>
                          </span>
                        </a>
                    </div>
                  </div>
                  <span  
                  class="fs-20">
                  <i class="fa fa-share"></i>
                </span>
                <span *ngIf="response.node?.templatesCount">
                  {{response.node?.templatesCount ? response.node?.templatesCount : '' }}
                </span>
              </div>
            </div>
            <div *ngIf="showCreateResponse()">
              <button class="app-btn response-btn" data-event="click-use-response"
                (click)="useThisResponse(response?.node)">{{'Use this response' | translate}}</button>
            </div>
          </div>
        </div>
      </ng-container>
    </div>   
  </div>   
</section>
<div *ngIf="selectedUser && showLeaderProfileModal">
  <app-user-profile-modal (close)="closeModal($event)" [userId]="selectedUser"></app-user-profile-modal>
</div>

<!-- rating-model -->
<div class="feedback-index">
  <div bsModal #feedbackModal="bs-modal" class="modal fade" tabindex="-1" [ngClass]="step == 2 ? 'align-center' : ''"
    [config]="{show: false, backdrop: 'static', ignoreBackdropClick: true, keyboard: false}" role="dialog"
    aria-labelledby="feedbackModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <p class="heading" *ngIf="!responseSubmitted">{{'How satisfied are you with this draft?' | translate}}</p>
          <p class="heading" *ngIf="responseSubmitted">
            {{'Here’re the overall satisfation levels for this draft from people' | translate}}</p>
        </div>
        <div class="modal-body">
          <label class="radio-block">
            <div class="radio-btn">
              <div class="radio-text" [class.active-text]="responseSubmitted && responseFeedback === 'dissatisfied'">
                {{'Dissatisfied' | translate}}</div>
              <div class="mx-2 count-text" *ngIf="responseFeedback && responseSubmitted">{{satisfactionRatingDistribution?.dissatisfied ?
                  satisfactionRatingDistribution?.dissatisfied : 0}}</div>
              <div *ngIf="responseFeedback" class="progress-color"
                [class.active-progress]="responseSubmitted && responseFeedback === 'dissatisfied'"
                [ngStyle]="{'width': satisfactionRatingDistribution?.dissatisfied ? getPercentageValue(satisfactionRatingDistribution, 'dissatisfied') + '%' : '0%' }">
              </div>
            </div>
            <div class="input-space">
              <input type="radio" class="cm-radio ml-3" name="feedback" value="dissatisfied"
                [(ngModel)]="responseFeedback" (ngModelChange)="choose($event)"
                [disabled]="(responseSubmitted && responseFeedback && responseFeedback !== 'dissatisfied')">
            </div>
          </label>
          <label class="radio-block">
            <div class="radio-btn">
              <div class="radio-text"
                [class.active-text]="responseSubmitted && responseFeedback === 'somewhat_dissatisfied'">
                {{'Somewhat Dissatisfied' | translate}}</div>
              <div class="mx-2 count-text" *ngIf="responseFeedback && responseSubmitted">{{satisfactionRatingDistribution?.somewhat_dissatisfied
                  ? satisfactionRatingDistribution?.somewhat_dissatisfied : 0}}</div>
              <div *ngIf="responseFeedback" class="progress-color"
                [class.active-progress]="responseSubmitted && responseFeedback === 'somewhat_dissatisfied'"
                [ngStyle]="{'width': satisfactionRatingDistribution?.somewhat_dissatisfied ? getPercentageValue(satisfactionRatingDistribution, 'somewhat_dissatisfied') + '%' : '0%' }">
              </div>
            </div>
            <div class="input-space">
              <input type="radio" class="cm-radio ml-3" name="feedback" value="somewhat_dissatisfied"
                [(ngModel)]="responseFeedback" (ngModelChange)="choose($event)"
                [disabled]="(responseSubmitted && responseFeedback && responseFeedback !== 'somewhat_dissatisfied')">
            </div>
          </label>
          <label class="radio-block">
            <div class="radio-btn">
              <div class="radio-text"
                [class.active-text]="responseSubmitted && responseFeedback === 'somewhat_satisfied'">
                {{'Somewhat Satisfied' | translate}}</div>
              <div class="mx-2 count-text" *ngIf="responseFeedback && responseSubmitted">{{satisfactionRatingDistribution?.somewhat_satisfied
                  ? satisfactionRatingDistribution?.somewhat_satisfied : 0}}</div>
              <div *ngIf="responseFeedback" class="progress-color"
                [class.active-progress]="responseSubmitted && responseFeedback === 'somewhat_satisfied'"
                [ngStyle]="{'width': satisfactionRatingDistribution?.somewhat_satisfied ? getPercentageValue(satisfactionRatingDistribution, 'somewhat_satisfied') + '%' : '0%' }">
              </div>
            </div>
            <div class="input-space">
              <input type="radio" class="cm-radio ml-3" name="feedback" value="somewhat_satisfied"
                [(ngModel)]="responseFeedback" (ngModelChange)="choose($event)"
                [disabled]="(responseSubmitted && responseFeedback && responseFeedback !== 'somewhat_satisfied')">
            </div>
          </label>
          <label class="radio-block">
            <div class="radio-btn">
              <div class="radio-text" [class.active-text]="responseSubmitted && responseFeedback === 'satisfied'">
                {{'Satisfied' | translate}}</div>
              <div class="mx-2 count-text" *ngIf="responseFeedback && responseSubmitted">{{satisfactionRatingDistribution?.satisfied ?
                  satisfactionRatingDistribution?.satisfied : 0}}</div>
              <div *ngIf="responseFeedback" class="progress-color"
                [class.active-progress]="responseSubmitted && responseFeedback === 'satisfied'"
                [ngStyle]="{'width': satisfactionRatingDistribution?.satisfied ? getPercentageValue(satisfactionRatingDistribution, 'satisfied') + '%' : '0%' }">
              </div>
            </div>
            <div class="input-space">
              <input type="radio" class="cm-radio ml-3" name="feedback" value="satisfied" [(ngModel)]="responseFeedback"
                (ngModelChange)="choose($event)"
                [disabled]="(responseSubmitted && responseFeedback && responseFeedback !== 'satisfied')">
            </div>
          </label>
          <div class="footer-space" [ngClass]="responseSubmitted ? 'justify-content-between' : 'justify-content-end'">
            <div class="footer-space__left" *ngIf="responseSubmitted">
              <div class="points-text">{{'You get ' + earnedPoints + ' points for submitting this!'}}</div>
              <div class="link">{{'View Leaderboard' | translate}}</div>
            </div>
            <div class="footer-space__right">
              <button class="app-btn secondary mt-xs" *ngIf="responseSubmitted" (click)="closeFeedbackModal()">
                <p class="m-0">
                  <span class="submit-logo">
                    <picture class="citizen-logo">
                      <source srcset="assets/images/Vector.webp" type="image/webp">
                      <source srcset="assets/images/Vector.jpg" type="image/jpeg">
                      <img src="assets/images/Vector.jpg" />
                    </picture>
                  </span>
                  {{'Ok Great' | translate}}
                </p>
                <i class="fa fa-angle-right"></i>
              </button>
              <span class="mr-2" *ngIf="responseSubmitLoading">
                <img src="assets/images/loading.svg">
              </span>
              <button class="app-btn secondary" *ngIf="!responseSubmitted" (click)="createResponse()">
                <p class="m-0">
                  <span class="submit-logo">
                    <picture class="citizen-logo">
                      <source srcset="assets/images/Vector.webp" type="image/webp">
                      <source srcset="assets/images/Vector.jpg" type="image/jpeg">
                      <img src="assets/images/Vector.jpg" />
                    </picture>
                  </span>
                  {{'Select and submit' | translate}}
                </p>
                <i class="fa fa-angle-right"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<app-confirm-email-modal *ngIf="showConfirmEmailModal" (close)="showConfirmEmailModal = false">
</app-confirm-email-modal>


<!-- Thanks modal  -->
<div class="thankyou-modal" *ngIf="showThankYouModal">
  <div bsModal #thankyouModal="bs-modal" class="modal fade" tabindex="-1" [ngClass]="showThankYouModal? 'align-center' : ''"
    [config]="{show: true, backdrop: 'static', ignoreBackdropClick: true, keyboard: false}" role="dialog"
    aria-labelledby="thankyouModal">
    <div class="modal-dialog">
      <div data-event="thank-you-modal-appear" class="modal-content">
        <div class="modal-body">
          <div class="thankyou-inner">
            <button class="close-btn" (click)="showThankYouModal = false"><img src="assets/images/close.png" /></button>
            <div class="thankyou-inner__top">
              <img class="thankyou-img" src="assets/images/thankyou.png" />
              <div class="thankyou-content">
                <p>Thank you for your response</p>
                <p *ngIf="profileData?.responseSubmissionMessage ; else defaultContent"
                 [innerHTML]="profileData?.responseSubmissionMessage"></p>
                <ng-template #defaultContent>
                  <p *ngIf="profileData?.visibility === 'public_consultation'; else privateContent" >
                    We appreciate you taking the time to submit your response. 
                    Please consider sharing this Consultation on Social Media to help spread the word. 
                    Together, we can make our voices heard and action real change!
                  </p>
                  <ng-template #privateContent>
                    <p>
                      We appreciate you taking the time to submit your response. 
                      You can browse through our other open Consultations to give your feedback.
                    </p>
                  </ng-template>
                </ng-template>
              </div>
            </div> 
            <div class="thankyou-inner__bottom" *ngIf="profileData?.visibility === 'public_consultation'">
              <div class="social-list">
                <a class="social-item" [href]="getWhatsappUrl(currentUrl)" target="_blank">
                  <img src="assets/images/whatsapp.svg" alt="whatsapp logo" />
                </a>
                <a class="social-item" [href]="getTwitterUrl(currentUrl)" target="_blank">
                  <img src="assets/images/twitter.svg" alt="twitter logo" />
                </a>
                <a class="social-item" [href]="getFbUrl(currentUrl)" target="_blank">
                  <img src="assets/images/facebook.svg" alt="facebook logo" />
                </a>
                <a class="social-item" [href]="getLinkedinUrl(currentUrl)" target="_blank">
                  <img src="assets/images/linkedin.svg" alt="linkedin logo" />
                </a>
                <div class="social-item"
                (click)="copyMessage(currentUrl)" 
                [tooltip]="copyStatus ? 'Copied': 'Copy'">
                  <img src="assets/images/link.svg" alt="link logo" />
                </div>
              </div>
            </div> 
          </div>
          
        </div>
      </div>
    </div>
  </div>
</div>